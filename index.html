<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼é“è¨ˆç”»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: "Supportive Neutrals" - A calm and inviting palette using warm beige, soft browns, and a gentle green for success/accent states, creating a supportive and non-pressuring atmosphere. -->
    <!-- Application Structure Plan: The SPA is a task-oriented dashboard. It starts with a clear "Objective" section, followed by the main "Scoreboard" for motivation. Below are actionable sections: a "Referral Form" for member input, and a dynamic "Referral Board" to display submissions. This structure guides the user from understanding the purpose, to seeing progress, to taking direct action, creating a clear and functional workflow. The "How to Help" section at the end provides gentle guidance for those not yet ready to submit a form. -->
    <!-- Visualization & Content Choices:
        - WIG Progress -> Goal: Motivate & Track -> Viz: An interactive "Sugoroku" (board game) path (HTML/CSS/JS). -> Interaction: Submitting a referral form automatically advances the progress, lighting up the next number. A manual input allows for corrections. -> Justification: The game-like path is highly engaging and visually represents forward momentum. Automating the progress from form submissions provides immediate positive feedback for user actions.
        - Referral Form -> Goal: Capture user input easily -> Viz: A standard HTML form. -> Interaction: Users fill fields and submit. JS validates and processes data. -> Justification: A form is the most direct and universally understood method for data entry.
        - Referral Board -> Goal: Display submissions clearly -> Viz: A grid of "cards" (HTML/CSS/JS). -> Interaction: Clicking a card opens a modal with details. -> Justification: Cards provide a scannable overview, while the modal pattern allows for displaying detailed information on demand without cluttering the UI.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #FDFBF5;
            color: #4F463B;
        }
        .accent-bg { background-color: #E3F0E3; }
        .accent-text { color: #3A6B3A; }
        .secondary-bg { background-color: #F3EFE7; }
        .secondary-text { color: #786A59; }
        .main-bg { background-color: #FFFFFF; }
        .shadow-custom { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05); }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .sugoroku-step {
            transition: all 0.3s ease-in-out;
            border: 2px solid transparent;
        }
        .sugoroku-step.active {
            background-color: #FFD700;
            color: #8C6D00;
            border-color: #FBBF24;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        }
        .submit-button:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-4xl">

        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">ç¦éŸ³ã®è¼ªã‚’åºƒã’ã‚ˆã†ï¼</h1>
            <p class="mt-2 text-lg secondary-text">ä¼é“å®Ÿè¡Œè¨ˆç”»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</p>
        </header>

        <main class="space-y-8 md:space-y-12">
            
            <section id="objective" class="secondary-bg p-6 rounded-2xl text-center">
                <h2 class="text-xl font-bold text-gray-800">ã“ã®è¨ˆç”»ã®ç›®çš„</h2>
                <p class="mt-2 text-gray-700">ã“ã®è¨ˆç”»ã¯ã€ä¼šå“¡ãŒãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãªãã€è‡ªç„¶ãªå½¢ã§ä¼é“æ´»å‹•ã«å‚åŠ ã§ãã‚‹æ–‡åŒ–ã‚’è‚²ã‚€ã“ã¨ã‚’ç›®çš„ã¨ã—ã¾ã™ã€‚ä¼é“ä¸»ä»»æœ¬äººã‚‚ä¼šå“¡ã¨å®£æ•™å¸«ãŒä¸€è‡´ã™ã‚‹ã“ã¨ã®é›£ã—ã•ã«éœ‡ãˆãªãŒã‚‰ã€ã¾ãã€ã¨ã‚Šã‚ãˆãšã§ãã‚‹ã“ã¨ã‚„ã£ã¦ã¿ã‚ˆã†ã£ã¦ã„ã†ãƒ¡ãƒ³ã‚¿ãƒªãƒ†ã‚£ã§ã“ã®ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã«è‡³ã‚Šã¾ã—ãŸã€‚</p>
            </section>

            <section id="wig-scoreboard" class="main-bg p-6 rounded-2xl shadow-custom text-center">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800">ã§ããŸã‚‰æœ¬å½“ã«ã™ã”ã„ã</h2>
                <p class="mt-2 secondary-text text-base md:text-lg">ç›®æ¨™: å¹´æœ«ã¾ã§ã«<strong class="accent-text font-bold">10ä»¶</strong>ã®æ–°ã—ã„åå‰ã‚’ç´¹ä»‹ã™ã‚‹</p>
                <div class="mt-8 mb-6">
                    <div id="sugoroku-path" class="flex flex-wrap justify-center gap-3">
                    </div>
                </div>
                <p class="font-semibold text-gray-800 text-lg">é€²æ—: <span id="progress-text" class="accent-text text-2xl font-bold">0</span> / 10ä»¶</p>
                <div class="mt-6">
                    <label for="progress-input" class="block text-sm font-medium secondary-text mb-2">é€²æ—ã‚’ä¿®æ­£ã™ã‚‹ï¼ˆä¼é“ä¸»ä»»ç”¨ï¼‰:</label>
                    <input type="number" id="progress-input" min="0" max="10" value="0" class="w-24 p-2 text-center border-2 rounded-lg focus:ring-2 focus:ring-green-300 focus:border-green-500">
                </div>
            </section>

            <section id="action-opportunity" class="bg-blue-50 border-2 border-dashed border-blue-300 p-6 rounded-2xl shadow-custom">
                <h3 class="text-lg md:text-xl font-bold text-blue-800 flex items-center">
                    <span class="text-2xl mr-3">ğŸ’Œ</span>
                    æ´»å‹•ã®ãŠçŸ¥ã‚‰ã›
                </h3>
                <p id="opportunity-text" class="mt-2 text-base md:text-lg text-blue-700">
                    7/19ã«ä¼é“éƒ¨ã®ã‚³ãƒ³ã‚µãƒ¼ãƒˆè¦–è´ä¼šãŒã‚ã‚Šã¾ã™ï¼ãŠå‹é”ã‚’èª˜ã£ã¦ã€ä¸€ç·’ã«æ¥½ã—ã„æ™‚é–“ã‚’éã”ã™çµ¶å¥½ã®æ©Ÿä¼šã§ã™ï¼
                </p>
            </section>

            <section id="referral-form-section" class="main-bg p-6 rounded-2xl shadow-custom">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">å‹äººãƒ»çŸ¥äººã‚’ç´¹ä»‹ã™ã‚‹</h2>
                <form id="referral-form" class="space-y-4">
                    <div>
                        <label for="member-name" class="block text-sm font-bold secondary-text">ã‚ãªãŸã®ãŠåå‰ (ä¾‹: â—‹â—‹å…„å¼Ÿ/å§‰å¦¹) <span class="text-red-500">*</span></label>
                        <input type="text" id="member-name" name="member-name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500" required>
                    </div>
                    <div>
                        <label for="referral-name" class="block text-sm font-bold secondary-text">ç´¹ä»‹ã™ã‚‹æ–¹ã®ãŠåå‰ <span class="text-red-500">*</span></label>
                        <input type="text" id="referral-name" name="referral-name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500" required>
                    </div>
                    <div>
                        <label for="referral-address" class="block text-sm font-bold secondary-text">ä½æ‰€ (ä»»æ„)</label>
                        <input type="text" id="referral-address" name="referral-address" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label for="missionary-action" class="block text-sm font-bold secondary-text">å®£æ•™å¸«ã«ãŠé¡˜ã„ã—ãŸã„ã“ã¨ <span class="text-red-500">*</span></label>
                        <select id="missionary-action" name="missionary-action" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500" required>
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä»˜ãã®ãƒ¢ãƒ«ãƒ¢ãƒ³æ›¸ã‚’å±Šã‘ã‚‹">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä»˜ãã®ãƒ¢ãƒ«ãƒ¢ãƒ³æ›¸ã‚’å±Šã‘ã‚‹</option>
                            <option value="è¨ªå•ã—ã¦è‡ªå·±ç´¹ä»‹ã‚’ã™ã‚‹">è¨ªå•ã—ã¦è‡ªå·±ç´¹ä»‹ã‚’ã™ã‚‹</option>
                            <option value="æ¬¡ã®ã‚¤ãƒ™ãƒ³ãƒˆã«æ‹›å¾…ã™ã‚‹">æ¬¡ã®ã‚¤ãƒ™ãƒ³ãƒˆã«æ‹›å¾…ã™ã‚‹</option>
                            <option value="ãã®ä»–ï¼ˆå‚™è€ƒæ¬„ã«è¨˜å…¥ï¼‰">ãã®ä»–ï¼ˆå‚™è€ƒæ¬„ã«è¨˜å…¥ï¼‰</option>
                        </select>
                    </div>
                    <div>
                        <label for="remarks" class="block text-sm font-bold secondary-text">å‚™è€ƒæ¬„ (ä»»æ„)</label>
                        <textarea id="remarks" name="remarks" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"></textarea>
                    </div>
                    <button type="submit" id="submit-button" class="submit-button w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">ç´¹ä»‹ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã€ã™ã”ã‚ãã‚’é€²ã‚ã‚‹</button>
                </form>
            </section>

            <section id="referral-board-section">
                <h2 class="text-xl md:text-2xl font-bold text-center text-gray-800 mb-6">ç´¹ä»‹ãƒœãƒ¼ãƒ‰</h2>
                <div id="referral-board" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <div id="no-referrals-message" class="col-span-full text-center secondary-text p-8 secondary-bg rounded-lg">
                        <p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šä¸­...</p>
                    </div>
                </div>
            </section>

            <section id="how-to-help" class="text-center secondary-bg p-6 rounded-2xl">
                <h3 class="text-lg md:text-xl font-bold text-gray-800">ç§ã«ã§ãã‚‹ã“ã¨</h3>
                <div class="mt-4 grid md:grid-cols-3 gap-4 text-left">
                    <div class="main-bg p-4 rounded-lg shadow-custom">
                        <p class="font-bold text-gray-700">1. æ„›ã—ã¦ã¿ã‚‹</p>
                        <p class="text-sm secondary-text mt-1">æ•™ä¼šã«ã¤ã„ã¦å­¦ã‚“ã§ã»ã—ã„ãªï½ã£ã¦æ€ã†äººã®ãŸã‚ã«ãŠç¥ˆã‚Šã‚’ã—ã¦ã¿ãŸã‚Šã€æ…ˆæ„›ã¨å¾³ã‚’ã‚‚ã£ã¦æ¥ã—ãŸã‚Šã—ã¦ã¿ã‚‹ã€‚æ—¥å¸¸ç”Ÿæ´»ã«è‰¯ã„å½±éŸ¿ãŒã‚ã‚‹ã“ã¨é–“é•ã„ãªã—ï¼</p>
                    </div>
                    <div class="main-bg p-4 rounded-lg shadow-custom">
                        <p class="font-bold text-gray-700">2. åˆ†ã‹ã¡åˆã£ã¦ã¿ã‚‹</p>
                        <p class="text-sm secondary-text mt-1">ã€Œç§ã€ã‚¯ãƒªã‚¹ãƒãƒ£ãƒ³ãªã‚“ã ã‚ˆã­ã€ã£ã¦è‡ªå·±é–‹ç¤ºã—ã¦ã¿ã‚‹ã€‚èˆˆå‘³ã‚’æŒã£ã¦ã‚‚ã‚‰ãˆãªã„ã“ã¨ãŒã»ã¨ã‚“ã©ã§ã™ãŒã€ã‚­ãƒªã‚¹ãƒˆã®å…‰ã‚’ä¸€ç¬ã§ã‚‚ç…§ã‚‰ã™ã ã‘ã§ååˆ†ã™ã”ã„ã§ã™ï¼</p>
                    </div>
                    <div class="main-bg p-4 rounded-lg shadow-custom">
                        <p class="font-bold text-gray-700">3. æ‹›ã„ã¦ã¿ã‚‹</p>
                        <p class="text-sm secondary-text mt-1">ã©ã‚“ãªã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚‚ã„ã„ã®ã§æ‹›ã„ã¦ã¿ã‚‹ã€‚ä¸€ç•ªãƒãƒ¼ãƒ‰ãƒ«é«˜ã„ã‚ˆã­ã€‚ã§ããŸã‚‰ã»ã‚“ã¨ã«å¥‡è·¡ï¼</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-12 text-sm text-gray-400">
            <p>2025å¹´åº¦ ãƒ¯ãƒ¼ãƒ‰ä¼é“è¨ˆç”»</p>
        </footer>

        <div id="referral-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0">
            <div class="modal-content main-bg rounded-2xl shadow-xl w-full max-w-md p-6 transform scale-95 opacity-0">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ç´¹ä»‹ã®è©³ç´°</h3>
                <div class="space-y-3">
                    <div>
                        <p class="text-sm font-bold secondary-text">ç´¹ä»‹ã•ã‚ŒãŸæ–¹:</p>
                        <p id="modal-referral-name" class="text-lg text-gray-800"></p>
                    </div>
                    <div>
                        <p class="text-sm font-bold secondary-text">å®£æ•™å¸«ã¸ã®ãŠé¡˜ã„:</p>
                        <p id="modal-action" class="text-lg text-gray-800"></p>
                    </div>
                    <div id="modal-remarks-section" class="hidden">
                        <p class="text-sm font-bold secondary-text">å‚™è€ƒ:</p>
                        <p id="modal-remarks" class="text-lg text-gray-800 whitespace-pre-wrap"></p>
                    </div>
                </div>
                <button id="modal-close-btn" class="mt-6 w-full bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">é–‰ã˜ã‚‹</button>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc, setDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const app = {
            config: {
                totalSteps: 10,
            },
            state: {
                currentProgress: 0,
                db: null,
                auth: null,
                appId: typeof __app_id !== 'undefined' ? __app_id : 'default-app-id',
                planDocRef: null,
                referralsColRef: null,
            },
            elements: {
                progressInput: document.getElementById('progress-input'),
                progressText: document.getElementById('progress-text'),
                sugorokuPath: document.getElementById('sugoroku-path'),
                referralForm: document.getElementById('referral-form'),
                submitButton: document.getElementById('submit-button'),
                referralBoard: document.getElementById('referral-board'),
                noReferralsMessage: document.getElementById('no-referrals-message'),
                modal: document.getElementById('referral-modal'),
                modalReferralName: document.getElementById('modal-referral-name'),
                modalAction: document.getElementById('modal-action'),
                modalRemarksSection: document.getElementById('modal-remarks-section'),
                modalRemarks: document.getElementById('modal-remarks'),
                modalCloseBtn: document.getElementById('modal-close-btn'),
            },
            async init() {
                this.renderSugorokuPath();
                this.addEventListeners();
                
                try {
                    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                    const firebaseApp = initializeApp(firebaseConfig);
                    this.state.auth = getAuth(firebaseApp);
                    this.state.db = getFirestore(firebaseApp);

                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(this.state.auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(this.state.auth);
                    }
                    
                    this.setupFirestore();
                } catch (error) {
                    console.error("Firebase åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error);
                    this.elements.noReferralsMessage.textContent = "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
                }
            },
            setupFirestore() {
                this.state.planDocRef = doc(this.state.db, `artifacts/${this.state.appId}/public/data/missionaryPlan/main`);
                this.state.referralsColRef = collection(this.state.planDocRef, 'referrals');

                onSnapshot(this.state.planDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        this.elements.progressInput.value = data.progress || 0;
                        this.updateView();
                    } else {
                        setDoc(this.state.planDocRef, { progress: 0 });
                    }
                });
                
                const referralsQuery = query(this.state.referralsColRef, orderBy("createdAt", "desc"));
                onSnapshot(referralsQuery, (querySnapshot) => {
                    if (querySnapshot.empty) {
                        this.elements.noReferralsMessage.innerHTML = '<p>ã¾ã ç´¹ä»‹ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼</p>';
                        this.elements.noReferralsMessage.classList.remove('hidden');
                    } else {
                        this.elements.noReferralsMessage.classList.add('hidden');
                    }
                    this.elements.referralBoard.innerHTML = '';
                    querySnapshot.forEach((doc) => {
                        this.addReferralCard(doc.data());
                    });
                });
            },
            renderSugorokuPath() {
                let pathHTML = '';
                for (let i = 1; i <= this.config.totalSteps; i++) {
                    pathHTML += `<div class="sugoroku-step w-12 h-12 flex items-center justify-center text-lg font-bold rounded-full bg-gray-200 text-gray-500" data-step="${i}">${i}</div>`;
                }
                this.elements.sugorokuPath.innerHTML = pathHTML;
            },
            updateView() {
                this.state.currentProgress = parseInt(this.elements.progressInput.value, 10);
                if (isNaN(this.state.currentProgress) || this.state.currentProgress < 0) this.state.currentProgress = 0;
                if (this.state.currentProgress > this.config.totalSteps) this.state.currentProgress = this.config.totalSteps;
                
                this.elements.progressInput.value = this.state.currentProgress;
                this.elements.progressText.textContent = this.state.currentProgress;

                const steps = this.elements.sugorokuPath.querySelectorAll('.sugoroku-step');
                steps.forEach(step => {
                    const stepNumber = parseInt(step.dataset.step, 10);
                    if (stepNumber <= this.state.currentProgress) {
                        step.classList.add('active');
                        step.classList.remove('bg-gray-200', 'text-gray-500');
                    } else {
                        step.classList.remove('active');
                        step.classList.add('bg-gray-200', 'text-gray-500');
                    }
                });
            },
            addReferralCard(data) {
                const card = document.createElement('button');
                card.className = "referral-card main-bg p-4 rounded-lg shadow-custom text-center cursor-pointer hover:shadow-lg transition-shadow";
                card.innerHTML = `
                    <p class="font-bold text-gray-700">${data.memberName}ã‚ˆã‚Š</p>
                    <p class="text-sm secondary-text">ç´¹ä»‹ãŒã‚ã‚Šã¾ã—ãŸ</p>
                `;
                card.dataset.referralName = data.referralName;
                card.dataset.action = data.action;
                card.dataset.remarks = data.remarks;

                this.elements.referralBoard.appendChild(card);
            },
            async handleFormSubmit(e) {
                e.preventDefault();
                this.elements.submitButton.disabled = true;
                this.elements.submitButton.textContent = 'é€ä¿¡ä¸­...';

                const formData = new FormData(this.elements.referralForm);
                const data = {
                    memberName: formData.get('member-name'),
                    referralName: formData.get('referral-name'),
                    address: formData.get('referral-address'),
                    action: formData.get('missionary-action'),
                    remarks: formData.get('remarks'),
                    createdAt: serverTimestamp(),
                };

                try {
                    await addDoc(this.state.referralsColRef, data);
                    
                    const newProgress = this.state.currentProgress + 1;
                    if (newProgress <= this.config.totalSteps) {
                        await setDoc(this.state.planDocRef, { progress: newProgress }, { merge: true });
                    }
                    
                    this.elements.referralForm.reset();
                } catch (error) {
                    console.error("ç´¹ä»‹ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:", error);
                    alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
                } finally {
                    this.elements.submitButton.disabled = false;
                    this.elements.submitButton.textContent = 'ç´¹ä»‹ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆã—ã€ã™ã”ã‚ãã‚’é€²ã‚ã‚‹';
                }
            },
            showModal(data) {
                this.elements.modalReferralName.textContent = data.referralName;
                this.elements.modalAction.textContent = data.action;

                if (data.remarks) {
                    this.elements.modalRemarks.textContent = data.remarks;
                    this.elements.modalRemarksSection.classList.remove('hidden');
                } else {
                    this.elements.modalRemarksSection.classList.add('hidden');
                }

                this.elements.modal.classList.remove('hidden');
                setTimeout(() => {
                    this.elements.modal.classList.remove('opacity-0');
                    this.elements.modal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
                }, 10);
            },
            hideModal() {
                this.elements.modal.classList.add('opacity-0');
                this.elements.modal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    this.elements.modal.classList.add('hidden');
                }, 300);
            },
            addEventListeners() {
                this.elements.progressInput.addEventListener('change', async () => {
                    const newProgress = parseInt(this.elements.progressInput.value, 10);
                    await setDoc(this.state.planDocRef, { progress: newProgress }, { merge: true });
                });
                
                this.elements.referralForm.addEventListener('submit', (e) => this.handleFormSubmit(e));

                this.elements.referralBoard.addEventListener('click', (e) => {
                    const card = e.target.closest('.referral-card');
                    if (card) {
                        this.showModal(card.dataset);
                    }
                });

                this.elements.modalCloseBtn.addEventListener('click', () => this.hideModal());
                this.elements.modal.addEventListener('click', (e) => {
                    if (e.target === this.elements.modal) {
                        this.hideModal();
                    }
                });
            }
        };
        app.init();
    </script>
</body>
</html>
